<?xml version="1.0"?>
<root>
  <item>
    <name>Enable Vim Emulation</name>
    <identifier>remap.vim_emu_{{VIM_EMU_APP_NAME}}</identifier>
    <only>{{VIM_EMU_ONLY_APPS}}</only>
    <not>{{VIM_EMU_IGNORE_APPS}}</not>
    <block> <!-- INSERT MODE (OS Normal State) -->
      <block>
        <config_not>notsave.vim_emu_normal</config_not>
        <!-- Complement mode -->
        <block>
          <config_only>notsave.vim_emu_complement</config_only>
          <autogen>
            __KeyToKey__ KeyCode::N,
            MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
            KeyCode::CURSOR_DOWN,
          </autogen>
          <autogen>
            __KeyToKey__ KeyCode::P,
            MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
            KeyCode::CURSOR_UP,
          </autogen>
          <autogen>
            __KeyToKey__ KeyCode::H,
            MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
            KeyCode::ESCAPE,
            KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_complement,
          </autogen>
          <autogen>
            __KeyToKey__ KeyCode::ESCAPE, ModifierFlag::NONE,
            KeyCode::RETURN,
            KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_complement,
          </autogen>
          <autogen>
            __KeyToKey__ KeyCode::BRACKET_LEFT,
            MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
            KeyCode::RETURN,
            KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_complement,
          </autogen>
          <!-- Disable all other keys -->
          <include path="vim_emu_disable_keys.xml"></include>
        </block>
        <autogen>
          __KeyToKey__ KeyCode::N,
          MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
          KeyCode::ESCAPE,
          KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_complement,
        </autogen>
        <autogen>
          __KeyToKey__ KeyCode::P,
          MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
          KeyCode::ESCAPE,
          KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_complement,
        </autogen>
      </block>
      <!-- Enter NORMAL MODE with Esc/C-[ -->
      <block>
        <!-- Turn Off also IME if enabled -->
        <inputsource_only>JAPANESE</inputsource_only>
        <autogen>
          __KeyToKey__ KeyCode::BRACKET_LEFT,
          MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
          KeyCode::VK_CHANGE_INPUTSOURCE_ENGLISH,
          KeyCode::VK_CHANGE_INPUTSOURCE_JAPANESE,
          KeyCode::VK_CHANGE_INPUTSOURCE_ENGLISH,
          {{VIM_EMU_FORCE_ON_NORMAL_MODE}}
        </autogen>
        <autogen>
          __KeyToKey__ KeyCode::ESCAPE, ModifierFlag::NONE,
          KeyCode::VK_CHANGE_INPUTSOURCE_ENGLISH,
          KeyCode::VK_CHANGE_INPUTSOURCE_JAPANESE,
          KeyCode::VK_CHANGE_INPUTSOURCE_ENGLISH,
          {{VIM_EMU_FORCE_ON_NORMAL_MODE}}
        </autogen>
      </block>
      <autogen>
        __KeyToKey__ KeyCode::ESCAPE, ModifierFlag::NONE,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}}
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::BRACKET_LEFT,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}}
      </autogen>
    </block> <!--INSERT MODE -->
    <!-- *************************************** -->
    <!-- Start g command -->
    <block>
      <config_not>notsave.vim_emu_G</config_not>
      <autogen>
        __KeyToKey__ KeyCode::G, ModifierFlag::NONE,
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_G
      </autogen>
    </block>
    <!-- *************************************** -->
    <!-- YANK MODE -->
    <block>
      <config_only>notsave.vim_emu_normal</config_only>
      <autogen> <!-- Fix Y -->
        __KeyToKey__ KeyCode::Y,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::A, ModifierFlag::CONTROL_L|ModifierFlag::SHIFT_L,
        KeyCode::E, ModifierFlag::CONTROL_L|ModifierFlag::SHIFT_L,
        KeyCode::C, ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_line_copy,
      </autogen>
    </block>
    <include path="vim_emu_ydc_mode.xml">
      <replacementdef>
        <replacementname>CHAR</replacementname>
        <replacementvalue>Y</replacementvalue>
      </replacementdef>
      <replacementdef>
        <replacementname>AFTER</replacementname>
        <replacementvalue>
          KeyCode::C, ModifierFlag::COMMAND_L,
          {{VIM_EMU_FORCE_ON_NORMAL_MODE}}
        </replacementvalue>
      </replacementdef>
    </include> <!-- YANK MODE -->
    <!-- DELETE MODE -->
    <block>
      <config_only>notsave.vim_emu_D</config_only>
      <autogen> <!-- Fix dd -->
        __KeyToKey__ KeyCode::D, ModifierFlag::NONE,
        KeyCode::A, ModifierFlag::CONTROL_L,
        KeyCode::E, ModifierFlag::CONTROL_L|ModifierFlag::SHIFT_L,
        KeyCode::X, ModifierFlag::COMMAND_L,
        KeyCode::FORWARD_DELETE,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_line_copy,
      </autogen>
    </block>
    <include path="vim_emu_ydc_mode.xml">
      <replacementdef>
        <replacementname>CHAR</replacementname>
        <replacementvalue>D</replacementvalue>
      </replacementdef>
      <replacementdef>
        <replacementname>AFTER</replacementname>
        <replacementvalue>
          KeyCode::X, ModifierFlag::COMMAND_L,
          {{VIM_EMU_FORCE_ON_NORMAL_MODE}}
        </replacementvalue>
      </replacementdef>
    </include> <!-- DELETE MODE -->
    <!-- CHANGE MODE -->
    <block>
      <config_only>notsave.vim_emu_C</config_only>
      <autogen> <!-- Fix cw -->
        __KeyToKey__ KeyCode::W, ModifierFlag::NONE,
        KeyCode::CURSOR_RIGHT, ModifierFlag::SHIFT_L|ModifierFlag::OPTION_L,
        KeyCode::X, ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_OFF_ALL_MODE}},
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_line_copy,
      </autogen>
    </block>
    <include path="vim_emu_ydc_mode.xml">
      <replacementdef>
        <replacementname>CHAR</replacementname>
        <replacementvalue>C</replacementvalue>
      </replacementdef>
      <replacementdef>
        <replacementname>AFTER</replacementname>
        <replacementvalue>
          KeyCode::X, ModifierFlag::COMMAND_L,
          {{VIM_EMU_FORCE_OFF_ALL_MODE}}
        </replacementvalue>
      </replacementdef>
    </include> <!-- DELETE MODE -->
    <!-- *************************************** -->
    <block><!-- NORMAL MODE -->
      <config_only>notsave.vim_emu_normal</config_only>
      <!-- Enter INSERT MODE, i/I/a/A/o/O -->
      <autogen>
        __KeyToKey__ KeyCode::I, ModifierFlag::NONE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::I,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::CURSOR_LEFT, ModifierFlag::COMMAND_L,
        KeyCode::CURSOR_RIGHT, ModifierFlag::OPTION_L,
        KeyCode::CURSOR_LEFT, ModifierFlag::OPTION_L,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::A, ModifierFlag::NONE,
        KeyCode::CURSOR_RIGHT,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::A,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::CURSOR_RIGHT, ModifierFlag::COMMAND_L,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::O, ModifierFlag::NONE,
        KeyCode::CURSOR_RIGHT, ModifierFlag::COMMAND_L, KeyCode::RETURN,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::O,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::CURSOR_UP, KeyCode::CURSOR_RIGHT, ModifierFlag::COMMAND_L,
        KeyCode::RETURN, KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal
      </autogen>
      <!-- v: Enter VISUAL MODE -->
      <autogen>
        __KeyToKey__ KeyCode::V, ModifierFlag::NONE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal,
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_visual,
        KeyCode::CURSOR_RIGHT, ModifierFlag::SHIFT_L,
      </autogen>
      <!-- V: Enter VISUAL LINE MODE -->
      <autogen>
        __KeyToKey__ KeyCode::V,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal,
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_visual_line,
        KeyCode::CURSOR_LEFT, ModifierFlag::COMMAND_L,
        KeyCode::CURSOR_DOWN, ModifierFlag::SHIFT_L,
      </autogen>
      <!-- Cmd-v: Enter VISUAL BLOCK MODE -->
      <autogen>
        __KeyToKey__ KeyCode::V,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL|ModifierFlag::NONE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal,
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_visual_block,
        KeyCode::VK_LOCK_COMMAND_L_FORCE_ON,
        KeyCode::VK_LOCK_OPTION_L_FORCE_ON,
        KeyCode::VK_MOUSEKEY_LOCK_BUTTON_LEFT,
      </autogen>
      <!-- ":":Enter COMMAND MODE -->
      <autogen>
        __KeyToKey__ KeyCode::SEMICOLON,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_normal,
        KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_command,
      </autogen>
      <!-- Cursor Move -->
      <include path="vim_emu_move.xml"></include>
      <!-- Cut One Character -->
      <autogen>
        __KeyToKey__ KeyCode::X, ModifierFlag::NONE,
        KeyCode::FORWARD_DELETE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_line_copy
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::X,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::DELETE,
        KeyCode::VK_CONFIG_FORCE_OFF_notsave_vim_emu_line_copy
      </autogen>
      <!-- Paste -->
      <block>
        <config_only>notsave.vim_emu_line_copy</config_only>
        <autogen>
          __KeyToKey__ KeyCode::P, ModifierFlag::NONE,
          KeyCode::CURSOR_LEFT, ModifierFlag::COMMAND_L,
          KeyCode::CURSOR_DOWN,
          KeyCode::V, ModifierFlag::COMMAND_L,
          KeyCode::RETURN, KeyCode::CURSOR_UP,
        </autogen>
        <autogen>
          __KeyToKey__ KeyCode::P, MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT,
          KeyCode::CURSOR_LEFT, ModifierFlag::COMMAND_L,
          KeyCode::V, ModifierFlag::COMMAND_L,
          KeyCode::RETURN, KeyCode::CURSOR_UP,
        </autogen>
      </block>
      <block>
        <config_not>notsave.vim_emu_line_copy</config_not>
        <autogen>
          __KeyToKey__ KeyCode::P, ModifierFlag::NONE,
          KeyCode::CURSOR_RIGHT, KeyCode::V, ModifierFlag::COMMAND_L
        </autogen>
        <autogen>
          __KeyToKey__ KeyCode::P,
          MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
          KeyCode::V, ModifierFlag::COMMAND_L
        </autogen>
      </block>
      <!-- Undo/Redo -->
      <autogen> __KeyToKey__ KeyCode::U, ModifierFlag::NONE,
        KeyCode::Z, ModifierFlag::COMMAND_L,
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::U,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT, ModifierFlag::NONE,
        KeyCode::Z, ModifierFlag::COMMAND_L,
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::R,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL, ModifierFlag::NONE,
        KeyCode::Z, ModifierFlag::SHIFT_L|ModifierFlag::COMMAND_L,
      </autogen>
      <!-- Line Combining -->
      <autogen>
        __KeyToKey__ KeyCode::J,
        MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT|ModifierFlag::NONE,
        KeyCode::CURSOR_RIGHT, ModifierFlag::COMMAND_L|ModifierFlag::NONE,
        KeyCode::SPACE, KeyCode::FORWARD_DELETE, ModifierFlag::SHIFT_L,
      </autogen>
      <!-- Search -->
      <autogen>
        __KeyToKey__ KeyCode::SLASH, ModifierFlag::NONE,
        KeyCode::F, ModifierFlag::COMMAND_L, {{VIM_EMU_FORCE_OFF_ALL_MODE}}
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::N, ModifierFlag::NONE,
        KeyCode::G, ModifierFlag::COMMAND_L
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::N, MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_SHIFT,
        KeyCode::G, ModifierFlag::SHIFT_L|ModifierFlag::COMMAND_L
      </autogen>
      <!-- COMMA: delete next word, paste  current clipboard-->
      <autogen>
        __KeyToKey__ KeyCode::COMMA, ModifierFlag::NONE,
        KeyCode::CURSOR_RIGHT, ModifierFlag::SHIFT_L|ModifierFlag::OPTION_L,
        KeyCode::DELETE, KeyCode::V, ModifierFlag::COMMAND_L
      </autogen>
      <!-- Disable all other keys -->
      <include path="vim_emu_disable_keys.xml"></include>
    </block> <!--NORMAL MODE -->
    <!-- *************************************** -->
    <block> <!-- VISUAL MODE -->
      <config_only>notsave.vim_emu_visual</config_only>
      <!-- Copy and Paste -->
      <include path="vim_emu_copy_cut.xml"></include>
      <!-- Move -->
      <include path="vim_emu_move.xml">
        <replacementdef>
          <replacementname>USE_SHIFT</replacementname>
          <replacementvalue>ModifierFlag::SHIFT_L|</replacementvalue>
        </replacementdef>
      </include>
      <!-- Disable all other keys -->
      <include path="vim_emu_disable_keys.xml"></include>
    </block> <!-- VISUAL MODE -->
    <block> <!-- VISUAL LINE MODE -->
      <config_only>notsave.vim_emu_visual_line</config_only>
      <!-- Copy and Paste -->
      <include path="vim_emu_copy_cut.xml"></include>
      <!-- Move -->
      <!-- Fix PageUp/Down -->
      <!-- OPTION can't be used with SHIFT for them -->
      <autogen>
        __KeyToKey__ KeyCode::B, MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL,
        KeyCode::CURSOR_UP, ModifierFlag::SHIFT_L|ModifierFlag::FN,
        {{AFTER}}
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::F, MODIFIERFLAG_EITHER_LEFT_OR_RIGHT_CONTROL,
        KeyCode::CURSOR_DOWN, ModifierFlag::SHIFT_L|ModifierFlag::FN,
        {{AFTER}}
      </autogen>
      <include path="vim_emu_move_up_down.xml">
        <replacementdef>
          <replacementname>USE_SHIFT</replacementname>
          <replacementvalue>ModifierFlag::SHIFT_L|</replacementvalue>
        </replacementdef>
        <replacementdef>
          <replacementname>LINECOPY</replacementname>
          <replacementvalue>
            KeyCode::VK_CONFIG_FORCE_ON_notsave_vim_emu_line_copy
          </replacementvalue>
        </replacementdef>
      </include>
      <!-- Disable all other keys -->
      <include path="vim_emu_disable_keys.xml"></include>
    </block> <!-- VISUAL LINE MODE -->
    <block> <!-- VISUAL BLOCK MODE -->
      <config_only>notsave.vim_emu_visual_block</config_only>
      <!-- Copy and Paste -->
      <include path="vim_emu_copy_cut.xml"></include>
      <!-- Move -->
      <autogen>
        __KeyToKey__ KeyCode::H, ModifierFlag::NONE, KeyCode::VK_MOUSEKEY_LEFT
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::J, ModifierFlag::NONE, KeyCode::VK_MOUSEKEY_DOWN
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::K, ModifierFlag::NONE, KeyCode::VK_MOUSEKEY_UP
      </autogen>
      <autogen>
        __KeyToKey__ KeyCode::L, ModifierFlag::NONE, KeyCode::VK_MOUSEKEY_RIGHT
      </autogen>
      <!-- Disable all other keys -->
      <include path="vim_emu_disable_keys.xml"></include>
    </block> <!-- VISUAL BLOCK MODE -->
    <!-- *************************************** -->
    <block> <!-- COMMAND MODE -->
      <config_only>notsave.vim_emu_command</config_only>
      <autogen> <!-- Save -->
        __KeyToKey__ KeyCode::RETURN, ModifierFlag::EXTRA1|ModifierFlag::NONE,
        KeyCode::S, ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
      </autogen>
      <autogen> <!-- Save As -->
        __KeyToKey__ KeyCode::SPACE, ModifierFlag::EXTRA1|ModifierFlag::NONE,
        KeyCode::S, ModifierFlag::SHIFT_L|ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
      </autogen>
      <autogen> <!-- Save and Quiet -->
        __KeyToKey__ KeyCode::Q, ModifierFlag::EXTRA1|ModifierFlag::NONE,
        KeyCode::S, ModifierFlag::COMMAND_L,
        KeyCode::W, ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
      </autogen>
      <autogen> <!-- w (Used with above) -->
        __KeyToKey__ KeyCode::W, ModifierFlag::NONE,
        KeyCode::VK_STICKY_EXTRA1_FORCE_ON
      </autogen>
      <autogen> <!-- Quit -->
        __KeyToKey__ KeyCode::Q, ModifierFlag::NONE,
        KeyCode::W, ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
      </autogen>
      <autogen> <!-- Help -->
        __KeyToKey__ KeyCode::H, ModifierFlag::NONE,
        KeyCode::SLASH, ModifierFlag::SHIFT_L|ModifierFlag::COMMAND_L,
        {{VIM_EMU_FORCE_ON_NORMAL_MODE}},
      </autogen>
    </block> <!-- COMMAND MODE -->
  </item>
</root>
